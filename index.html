<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ArchViz 360 Viewer</title>

<script src="https://cdn.scaleflex.it/plugins/js-cloudimage-360-view/latest/js-cloudimage-360-view.min.js"></script>

<style>
body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.viewer{
  width:100%;
  max-width:1280px;
  aspect-ratio:16/9;
}
</style>
</head>
<body>

<div class="viewer">
  <div
    id="viewer360"
    class="cloudimage-360"
    data-filename-x="{index}.jpg"
    data-amount-x="24"
    data-amount-y="5"
    data-index-zero-base="false"
    data-image-list-format="0000"
    data-drag-speed="150"
    data-autoplay="false"
    data-zoom="3"
    data-fullscreen="true"
    data-magnifier="2">
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const params = new URLSearchParams(window.location.search);
  const project = params.get("project");
  const view = params.get("view");

  const bucket = "https://storage.googleapis.com/archviz-viewer-images";
  const viewer = document.getElementById("viewer360");

  if(!project || !view){
    document.body.innerHTML = "<h1 style='color:white'>Missing project or view</h1>";
    return;
  }

  let folder = "";

  if(view === "exterior"){
    folder = `${bucket}/${project}/exterior/lowres/`;
    viewer.setAttribute("data-zoom-folder", `${bucket}/${project}/exterior/highres/`);
  } else {
    folder = `${bucket}/${project}/rooms/${view}/`;
    viewer.setAttribute("data-amount-y", "1"); // rooms are single row
  }

  viewer.setAttribute("data-folder", folder);

  // SAFE INIT (after attributes exist)
  if (window.CI360) {
    window.CI360.destroy();
    window.CI360.init();
  }
});
</script>

</body>
</html>
