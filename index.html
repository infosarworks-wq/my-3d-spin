<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Viewer</title>

<style>
body{
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* Portrait container 720x1280 ratio */
.viewer{
  aspect-ratio: 9 / 16;          /* 720x1280 */
  height: 90vh;
  max-height: 1280px;
  position: relative;
  cursor: grab;
  overflow: hidden;
  background:#000;
}

/* Image */
.viewer img{
  width:100%;
  height:100%;
  object-fit: contain;
  user-select:none;
  pointer-events:none;
  transform-origin:center center;
  transition: transform 0.05s linear;
}

/* Fullscreen button */
.fullscreen-btn{
  position:absolute;
  top:10px;
  right:10px;
  background:rgba(0,0,0,0.6);
  color:#fff;
  border:none;
  padding:8px 12px;
  cursor:pointer;
  font-size:14px;
  z-index:10;
}
</style>
</head>

<body>

<div class="viewer" id="viewer">
  <button class="fullscreen-btn" id="fsBtn">â›¶</button>
  <img id="frame" src="images/Lowres/0001.png" alt="360 view">
</div>

<script>
/* CONFIG */
const totalX = 24;
const totalY = 5;

/* STATE */
let x = 1;
let y = 1;
let scale = 1;
let isHiRes = false;

let panX = 0;
let panY = 0;

const frame = document.getElementById("frame");
const viewer = document.getElementById("viewer");
const fsBtn = document.getElementById("fsBtn");

let isDragging = false;
let startX = 0;
let startY = 0;

/* PATH */
function getImagePath(index){
  const padded = String(index).padStart(4, "0");
  return isHiRes
    ? `images/highres/${padded}.png`
    : `images/Lowres/${padded}.png`;
}

/* UPDATE FRAME */
function updateFrame(){
  const index = (y - 1) * totalX + x;
  frame.src = getImagePath(index);
}

/* APPLY TRANSFORM */
function applyTransform(){
  frame.style.transform =
    `translate(${panX}px, ${panY}px) scale(${scale})`;
}

/* DRAG */
viewer.addEventListener("mousedown", e=>{
  isDragging = true;
  startX = e.clientX;
  startY = e.clientY;
  viewer.style.cursor = "grabbing";
});

window.addEventListener("mouseup", ()=>{
  isDragging = false;
  viewer.style.cursor = "grab";
});

window.addEventListener("mousemove", e=>{
  if(!isDragging) return;

  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  startX = e.clientX;
  startY = e.clientY;

  /* ðŸ”¹ If zoomed â†’ PAN ONLY */
  if(scale > 1){
    panX += dx;
    panY += dy;
    applyTransform();
    return;
  }

  /* ðŸ”¹ If not zoomed â†’ ROTATE */
  if(Math.abs(dx) > 6){
    x += dx > 0 ? -1 : 1;
    if(x < 1) x = totalX;
    if(x > totalX) x = 1;
  }

  if(Math.abs(dy) > 10){
    y += dy > 0 ? 1 : -1;
    if(y < 1) y = 1;
    if(y > totalY) y = totalY;
  }

  updateFrame();
});

/* WHEEL ZOOM */
viewer.addEventListener("wheel", e=>{
  e.preventDefault();

  scale += e.deltaY * -0.002;
  scale = Math.min(Math.max(1, scale), 5);

  /* Reset pan if zoomed out */
  if(scale === 1){
    panX = 0;
    panY = 0;
  }

  applyTransform();
},{ passive:false });

/* DOUBLE CLICK â†’ HI-RES + ZOOM */
viewer.addEventListener("dblclick", ()=>{
  isHiRes = !isHiRes;

  if(isHiRes){
    scale = 2;
  }else{
    scale = 1;
    panX = 0;
    panY = 0;
  }

  applyTransform();
  updateFrame();
});

/* FULLSCREEN */
fsBtn.addEventListener("click", ()=>{
  if(!document.fullscreenElement){
    viewer.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
});

/* TOUCH SUPPORT */
viewer.addEventListener("touchstart", e=>{
  const t = e.touches[0];
  isDragging = true;
  startX = t.clientX;
  startY = t.clientY;
});

viewer.addEventListener("touchend", ()=>{
  isDragging = false;
});

viewer.addEventListener("touchmove", e=>{
  if(!isDragging) return;

  const t = e.touches[0];
  const dx = t.clientX - startX;
  const dy = t.clientY - startY;

  startX = t.clientX;
  startY = t.clientY;

  if(scale > 1){
    panX += dx;
    panY += dy;
    applyTransform();
    return;
  }

  if(Math.abs(dx) > 6){
    x += dx > 0 ? -1 : 1;
    if(x < 1) x = totalX;
    if(x > totalX) x = 1;
  }

  if(Math.abs(dy) > 10){
    y += dy > 0 ? 1 : -1;
    if(y < 1) y = 1;
    if(y > totalY) y = totalY;
  }

  updateFrame();
});
</script>

</body>
</html>
